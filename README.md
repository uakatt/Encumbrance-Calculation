Encumbrance Calculation Enhancement
======================

This git repository represents the University of Arizona (the UA)'s _Encumbrance Calculation Enhancement_ modification to **KFS 3.0**, in the form of patch files (generated by svn diff), liquibase scripts, and documentation.
This "patch package" is designed to be informative to technical developers in the position to
apply patch files to the java source code of KFS. In order to better serve such an endeavor,
this README contains several informative sections:

* <a href="#jiras">List of Jiras</a> - This list contains every Jira ticket at the University of Arizona
  that relates to this modification. It provides reverse documentation back to the developers at
  the UA in case of questions regarding how this patch package was created.
* <a href="#liquibase_changesets">List of Liquibase Changesets</a> - This list contains any
  liquibase changeset files that were associated with this modification.
* <a href="#patch_files">List of Patch Files</a> - This is a list of each patch file that needs
  to be applied to the KFS source code in order to realize the modification. This list does _not_
  include patch files for revisions that didn't touch the `trunk/` at the UA.
  Before a modification was merged with `trunk/`, it may have been tweaked, reworked, refactored,
  code reviewed, etc, in handfuls of revisions in a feature branch.
* <a href="#revisions">List of Revisions</a> - This list contains every revision associated with
  this modification. Many of which, as you will see, only touch files in a feature branch. The
  revisions that actually made it into the actual modification touch files in `trunk/`. The list
  of patch files is a better reference of which are these revisions.
* <a href="#files">Lists of Files</a> - These lists contain every file that was created,
  modified, or deleted for this enhancement.
* <a href="#post_mod_changes">List of Post-Modification Changes</a> - This list contains
  revision numbers that are _not_ included in the patches, or raw patches, but that touched one
  or more key files involved in this modification.

<h2><a name="jiras">Jiras</a></h2>

This is a list of Jira tickets at the University of Arizona that relate to this modification. The subversion revisions tagged against each such jira are also listed:

* **KITT-834**: (The main jira for this modification)<br />
  revisions: #8119, #8325, #9287, #9288, #9307, #11045, #11189, #11539, #11905, #12247, #12292, #12493, #12756, #12758, #14054, #14055, #14487, #14666, #14695
* **KITT-842**: (A subtask of KITT-834)<br />
  revisions: #14615, #14616
* **KFSI-3563**: (A bug fix)<br />
  revisions: #18271, #18359, #18360

<h2><a name="liquibase_changesets">Liquibase Changesets</a></h2>

* `update/KITT-834.xml` saw the following activity:
  * created in [#8119](https://subversion.uits.arizona.edu/kitt-anon/kitt/!svn/bc/8119//financial-system/kfs-cfg-dbs/trunk/update/KITT-834.xml), [#8325](https://subversion.uits.arizona.edu/kitt-anon/kitt/!svn/bc/8325//financial-system/kfs-cfg-dbs/trunk/update/KITT-834.xml).
* `latest/dat/KREW.xml` saw the following activity:
  * changed in [#8119](https://subversion.uits.arizona.edu/kitt-anon/kitt/!svn/bc/8119//financial-system/kfs-cfg-dbs/trunk/latest/dat/KREW.xml).

(3 changes among 2 files)

<h2><a name="patch_files">Patch Files</a></h2>

This is a list of all of the patches for revisions that affected files in `trunk/`. The filenames in each has been modified, for easy digestion. UA's subversion server manages many Kuali projects in one Subversion project, so a file path like:

```
financial-system/kfs/trunk/src/org/kuali/kfs...
```

has been modified to:

```
src/org/kuali/kfs...
```

* [`patches/09307_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/09307_KITT-834_cleaned.diff) is the patch file for #9307.
* [`patches/11045_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/11045_KITT-834_cleaned.diff) is the patch file for #11045.
* [`patches/11189_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/11189_KITT-834_cleaned.diff) is the patch file for #11189.
* [`patches/11539_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/11539_KITT-834_cleaned.diff) is the patch file for #11539.
* [`patches/11905_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/11905_KITT-834_cleaned.diff) is the patch file for #11905.
* [`patches/12247_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/12247_KITT-834_cleaned.diff) is the patch file for #12247.
* [`patches/12292_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/12292_KITT-834_cleaned.diff) is the patch file for #12292.
* [`patches/12493_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/12493_KITT-834_cleaned.diff) is the patch file for #12493.
* [`patches/12756_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/12756_KITT-834_cleaned.diff) is the patch file for #12756.
* [`patches/12758_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/12758_KITT-834_cleaned.diff) is the patch file for #12758.
* [`patches/14054_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/14054_KITT-834_cleaned.diff) is the patch file for #14054.
* [`patches/14055_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/14055_KITT-834_cleaned.diff) is the patch file for #14055.
* [`patches/14666_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/14666_KITT-834_cleaned.diff) is the patch file for #14666.
* [`patches/14695_KITT-834_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/14695_KITT-834_cleaned.diff) is the patch file for #14695.
* [`patches/14615_KITT-842_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/14615_KITT-842_cleaned.diff) is the patch file for #14615.
* [`patches/14616_KITT-842_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/14616_KITT-842_cleaned.diff) is the patch file for #14616.
* [`patches/18271_KFSI-3563_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/18271_KFSI-3563_cleaned.diff) is the patch file for #18271.
* [`patches/18359_KFSI-3563_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/18359_KFSI-3563_cleaned.diff) is the patch file for #18359.
* [`patches/18360_KFSI-3563_cleaned.diff`](Encumbrance-Calculation-Enhancement/blob/master/patches/18360_KFSI-3563_cleaned.diff) is the patch file for #18360.

<h2><a name="revisions">Revisions</a></h2>

This is an ordered list of revisions that relate to this modification. There may not be a patch
file for every revision listed below for the following reasons:

* A revision might only affect a branch, perhaps one where development primarily took place. Any
  changes that finally made it into `trunk/` will be seen in revisions that specifically touch
  files in `trunk/`. Therefore, we do not create patch files for revisions that only affect a
  branch.
* A revision might only include a liquibase changeset that is executed by some automated process.
  Since each institution maintains different revision controls on their database, liquibase
  changesets are not provided as patches. They are instead presented as intact files under the
  `liquibase-changesets/` directory.

[Here](Encumbrance-Calculation-Enhancement/blob/master/patch_log.txt) is a printout of `svn log -v` for each revision.

*   \#9307 was committed against KITT-834 on 2010-04-18 19:32:38 UTC by <strong>jhkeller</strong>.

    > KITT-834 : labor distribution batch job to process incoming file from HCM and adjust salary encumbrance balances accordingly
*   \#11045 was committed against KITT-834 on 2010-07-10 22:04:10 UTC by <strong>jhkeller</strong>.

    > KITT-834 : Made sort logic tolerant of misformatted lines/files.
*   \#11189 was committed against KITT-834 on 2010-07-16 03:12:31 UTC by <strong>jhkeller</strong>.

    > KITT-834 : corrected SQL for retrieving encumbrance balances
*   \#11539 was committed against KITT-834 on 2010-07-29 05:03:11 UTC by <strong>jhkeller</strong>.

    > KITT-834 : updated labor encumbrance calculations to process within ld/holding instead of ld/originEntry
*   \#11905 was committed against KITT-834 on 2010-08-10 04:57:48 UTC by <strong>jhkeller</strong>.

    > KITT-834 : updated service to add the done file when complete
*   \#12247 was committed against KITT-834 on 2010-08-20 03:59:54 UTC by <strong>jhkeller</strong>.

    > KITT-834 : updated code to not blank out the encumbrance update code
*   \#12292 was committed against KITT-834 on 2010-08-21 21:29:12 UTC by <strong>jhkeller</strong>.

    > KITT-834 : updated timestamps and filenames of resulting files per user request
*   \#12493 was committed against KITT-834 on 2010-08-28 03:14:21 UTC by <strong>jhkeller</strong>.

    > KITT-834 : changed "." to "-" before date per user request
*   \#12756 was committed against KITT-834 on 2010-09-01 03:30:57 UTC by <strong>jhkeller</strong>.

    > KITT-834 : updated to only set the document type code if not provided on the input file
*   \#12758 was committed against KITT-834 on 2010-09-01 03:42:58 UTC by <strong>jhkeller</strong>.

    > KITT-834 : Update to ensure that leading spaces do not cause a sort problem
*   \#14054 was committed against KITT-834 on 2010-10-17 18:53:14 UTC by <strong>jhkeller@CATNET.ARIZONA.EDU</strong>.

    > KITT-834 : Fixed file name checking
    > Updated test to properly fail per functional feedback on the copying of the description.  See comments on KITT-842
*   \#14055 was committed against KITT-834 on 2010-10-17 19:13:13 UTC by <strong>jhkeller@CATNET.ARIZONA.EDU</strong>.

    > KITT-834 : Updated the encumbrance file to pull the person's name and use that for the description if fully removing a record (since there is no record in the input file from which to get a proper description.)
*   \#14615 was committed against KITT-842 on 2010-11-11 16:20:35 UTC by <strong>jhkeller@CATNET.ARIZONA.EDU</strong>.

    > KITT-842 : Updated to set positions 9-13 of the document number to "00000" on entries which are created from scratch by the process
*   \#14616 was committed against KITT-842 on 2010-11-11 16:23:58 UTC by <strong>jhkeller@CATNET.ARIZONA.EDU</strong>.

    > KITT-842 : Updated to set positions 9-14 of the document number to "200000" on entries which are created from scratch by the process
*   \#14666 was committed against KITT-834 on 2010-11-16 03:43:29 UTC by <strong>jhkeller@CATNET.ARIZONA.EDU</strong>.

    > KITT-834 : updated to use L, F M format for the description when there is no input record
*   \#14695 was committed against KITT-834 on 2010-11-17 03:31:01 UTC by <strong>jhkeller@CATNET.ARIZONA.EDU</strong>.

    > KITT-834 : Adjusted logic to first 9 + 00000 instead of first 8 + 200000
*   \#18271 was committed against KFSI-3563 on 2011-05-05 10:00:46 UTC by <strong>wliang@CATNET.ARIZONA.EDU</strong>.

    > KFSI-3563 KITT-2402 modify comparator to not use object type code as a basis for comparison.
*   \#18359 was committed against KFSI-3563 on 2011-05-07 07:39:59 UTC by <strong>wliang@CATNET.ARIZONA.EDU</strong>.

    > KFSI-3563 KITT-2402 fix handling of object type codes to allow job to generate blanks since HCM does not provide obj type codes
*   \#18360 was committed against KFSI-3563 on 2011-05-07 23:55:33 UTC by <strong>wliang@CATNET.ARIZONA.EDU</strong>.

    > KFSI-3563 KITT-2402 put the object type code at the end of the sort order

<h2><a name="files">Files</a></h2>

Files **created** for this modification (21 files)

    /test/unit/src/edu/arizona/kfs/module/ld/batch/LaborEncumbranceAdjustmentJobTest.java
    /test/unit/src/edu/arizona/kfs/module/ld/batch/dataaccess
    /test/unit/src/edu/arizona/kfs/module/ld/batch/dataaccess/impl
    /test/unit/src/edu/arizona/kfs/module/ld/batch/dataaccess/impl/LaborEncumbranceAdjustmentDaoJdbcTest.java
    /test/unit/src/edu/arizona/kfs/module/ld/batch/laborEncumbranceAdjustmentJobTest.properties
    /work/src/edu/arizona/kfs/module/ld/batch/LaborAppendEncumbranceTransactionsStep.java
    /work/src/edu/arizona/kfs/module/ld/batch/LaborBuildEncumbranceBalanceFileStep.java
    /work/src/edu/arizona/kfs/module/ld/batch/LaborCalculateEncumbranceAdjustmentsStep.java
    /work/src/edu/arizona/kfs/module/ld/batch/LaborEncumbranceBalanceOriginEntrySortComparator.java
    /work/src/edu/arizona/kfs/module/ld/batch/LaborSortEncumbranceFileStep.java
    /work/src/edu/arizona/kfs/module/ld/batch/dataaccess
    /work/src/edu/arizona/kfs/module/ld/batch/dataaccess/LaborEncumbranceAdjustmentDao.java
    /work/src/edu/arizona/kfs/module/ld/batch/dataaccess/impl
    /work/src/edu/arizona/kfs/module/ld/batch/dataaccess/impl/LaborEncumbranceAdjustmentDaoJdbc.java
    /work/src/edu/arizona/kfs/module/ld/batch/report
    /work/src/edu/arizona/kfs/module/ld/batch/report/LaborEncumbranceJobReportData.java
    /work/src/edu/arizona/kfs/module/ld/batch/report/LaborEncumbranceReportWriterService.java
    /work/src/edu/arizona/kfs/module/ld/batch/service
    /work/src/edu/arizona/kfs/module/ld/batch/service/LaborEncumbranceAdjustmentService.java
    /work/src/edu/arizona/kfs/module/ld/batch/service/impl
    /work/src/edu/arizona/kfs/module/ld/batch/service/impl/LaborEncumbranceAdjustmentServiceImpl.java

Files **modified** for this modification (1 files)

    /work/src/edu/arizona/kfs/module/ld/spring-ld.xml

<h2><a name="extra_files">Extra Files</a></h2>

<h2><a name="post_mod_changes">Post Mod Changes</a></h2>

For each file that was changed or added for this modification, I've looked at its history in subversion (`svn log <file_name>`) to find whether later fixes were committed against this modification that I might have missed. There were some :) They may be fixes to the modification, or further enhancements, or changes completely unrelated. Please contact the UA for more information about a given revision number, or Jira ticket. Here they are:

*   **#12245** touches /test/unit/src/edu/arizona/kfs/module/ld/batch/dataaccess/impl/LaborEncumbranceAdjustmentDaoJdbcTest.java.

    > KITT-1480 : bumped the test constant to the current fiscal year
*   **#14944** touches: 
    * /work/src/edu/arizona/kfs/module/ld/batch/dataaccess/impl/LaborEncumbranceAdjustmentDaoJdbc.java
    * /work/src/edu/arizona/kfs/module/ld/batch/service/impl/LaborEncumbranceAdjustmentServiceImpl.java
    * /work/src/edu/arizona/kfs/module/ld/batch/dataaccess/LaborEncumbranceAdjustmentDao.java
    * /work/src/edu/arizona/kfs/module/ld/batch/service/LaborEncumbranceAdjustmentService.java
    * /work/src/edu/arizona/kfs/module/ld/batch/report/LaborEncumbranceReportWriterService.java
    * /work/src/edu/arizona/kfs/module/ld/batch/report/LaborEncumbranceJobReportData.java

    > KITT-1750 : Chart outbound messaging 
    > - added full export job
    > - added properties for initial delay and interval
    > - added protection from long error messages on outbound message send
    > - unrelated files are only being marked by SVN as merged (I don't know why)
*   **#17588** touches: 
    * /work/src/edu/arizona/kfs/module/ld/batch/dataaccess/impl/LaborEncumbranceAdjustmentDaoJdbc.java
    * /work/src/edu/arizona/kfs/module/ld/batch/service/impl/LaborEncumbranceAdjustmentServiceImpl.java
    * /work/src/edu/arizona/kfs/module/ld/batch/dataaccess/LaborEncumbranceAdjustmentDao.java
    * /work/src/edu/arizona/kfs/module/ld/batch/service/LaborEncumbranceAdjustmentService.java
    * /work/src/edu/arizona/kfs/module/ld/batch/report/LaborEncumbranceReportWriterService.java
    * /work/src/edu/arizona/kfs/module/ld/batch/report/LaborEncumbranceJobReportData.java

    > KFSI-2634
    > KITT-2202
    > First commit of Purap Matching Mod.  Only merge-byproduct SVN Property updates.

*   **#19584** touches /work/src/edu/arizona/kfs/module/ld/batch/service/impl/LaborEncumbranceAdjustmentServiceImpl.java.

    > KFSI-4055
    > KITT-2597
    > Added some code to always unconditionally make sure the Object Type Code is there in the output line of the Encumbrance Adjustment Job.
*   **#22203** touches /work/src/edu/arizona/kfs/module/ld/batch/service/impl/LaborEncumbranceAdjustmentServiceImpl.java.

    > KFSI-5725 KITT-2963 make amount absolute without negatives
*   **#22377** touches /work/src/edu/arizona/kfs/module/ld/batch/service/impl/LaborEncumbranceAdjustmentServiceImpl.java.

    > KFSI-5725
    > Updated the labor encumbrance adjustment job to handle the case of no new encumbrance, and a negative existing encumbrance.
    > Also made some minor cleanup changes, mostly in the proper closing of file handles.
*   **#22378** touches /work/src/edu/arizona/kfs/module/ld/batch/service/impl/LaborEncumbranceAdjustmentServiceImpl.java.

    > KFSI-5725
    > Updated the labor encumbrance adjustment job to handle the case of no new encumbrance, and a negative existing encumbrance.
    > Also made some minor cleanup changes, mostly in the proper closing of file handles.
*   **#22743** touches /work/src/edu/arizona/kfs/module/ld/batch/service/impl/LaborEncumbranceAdjustmentServiceImpl.java.

    > KFSI-5726 change origin code on encumbrance job
*   **#23100** touches /work/src/edu/arizona/kfs/module/ld/batch/service/impl/LaborEncumbranceAdjustmentServiceImpl.java.

    > KFSI-5726 KITT-3019 change origin code in output file
*   **#23122** touches /work/src/edu/arizona/kfs/module/ld/batch/dataaccess/impl/LaborEncumbranceAdjustmentDaoJdbc.java.

    > KFSI-5984 KITT-3023 laborBuildEncumbranceBalanceFileStep pulls in records with balance types of PE
*   **#23673** touches: 
    * /work/src/edu/arizona/kfs/module/ld/batch/dataaccess/impl/LaborEncumbranceAdjustmentDaoJdbc.java
    * /work/src/edu/arizona/kfs/module/ld/batch/service/impl/LaborEncumbranceAdjustmentServiceImpl.java
    * /work/src/edu/arizona/kfs/module/ld/batch/LaborEncumbranceBalanceOriginEntrySortComparator.java

    > KITT-3050 KFSI-5984 Adding PE balance type to batch job

(11 revisions)

The following files were ignored here:

    spring-ld.xml

This means, for example, that `spring-ld.xml` was changed for this modification, but `spring-ld.xml`'s history was not used to build this list of revisions.

